<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ギルクラ2 設定推測チェッカー</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: 'Orbitron', sans-serif;
      background: linear-gradient(#101c2c, #1a1a1a);
      color: #e0f0ff;
      padding: 2em;
      max-width: 800px;
      margin: auto;
      text-align: center;
    }
    h1 {
      font-size: 1.5em;
      margin-bottom: 1em;
      text-shadow: 0 0 3px #00ffff;
    }
    .input-group {
      display: flex;
      gap: 1em;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 1em;
    }
    .input-group input {
      flex: 1 1 200px;
      padding: 0.5em;
      font-size: 1em;
    }
    button {
      padding: 0.7em 1.2em;
      font-size: 1em;
      background: linear-gradient(145deg, #00ffff, #6633ff);
      color: black;
      border: none;
      border-radius: 8px;
      box-shadow: 0 0 10px #00ffff;
      cursor: pointer;
      margin: 0.5em;
    }
    .result {
      margin-top: 1.5em;
      padding: 1em;
      background: rgba(0, 0, 0, 0.7);
      border: 1px solid #33f;
      border-radius: 8px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1em;
    }
    th, td {
      border: 1px solid #555;
      padding: 0.5em;
      text-align: center;
    }
    .highlight {
      color: #00ffff;
      font-weight: bold;
      text-shadow: 0 0 6px #00ffff;
    }
    ul {
      text-align: left;
      display: inline-block;
      margin-top: 1em;
    }
  </style>
</head>
<body>
  <h1>ギルクラ2 設定推測チェッカー</h1>

  <div class="input-group">
    <input id="atInput" type="number" placeholder="AT確率 (例: 460)" />
    <input id="rbInput" type="number" placeholder="ボーナス確率 (例: 315)" />
  </div>

  <div>
    <button onclick="checkSettings()">設定推測</button>
    <button onclick="resetHistory()">履歴リセット</button>
  </div>

  <div id="result" class="result"></div>

  <script>
    const settingData = [
      { setting: 1, at: 596.4, rb: 315.1 },
      { setting: 2, at: 571.6, rb: 312.6 },
      { setting: 3, at: 528.6, rb: 309.1 },
      { setting: 4, at: 447.0, rb: 297.6 },
      { setting: 5, at: 410.5, rb: 284.4 },
      { setting: 6, at: 375.5, rb: 273.5 }
    ];

    let history = [];

    function checkSettings() {
      const atInputEl = document.getElementById("atInput");
      const rbInputEl = document.getElementById("rbInput");
      const atInput = parseFloat(atInputEl.value);
      const rbInput = parseFloat(rbInputEl.value);

      if (isNaN(atInput) && isNaN(rbInput)) {
        document.getElementById("result").innerText = "AT確率かボーナス確率のいずれかを入力してください。";
        return;
      }

      atInputEl.value = "";
      rbInputEl.value = "";

      const current = {
        at: isNaN(atInput) ? null : atInput,
        rb: isNaN(rbInput) ? null : rbInput
      };
      history.push(current);

      const scoreSums = settingData.map(s => {
        let totalScore = 0;
        history.forEach(h => {
          let score = 0;
          if (h.at !== null) {
            const atDiff = Math.abs(h.at - s.at);
            score += Math.exp(-atDiff * 0.05);
          }
          if (h.rb !== null) {
            const rbDiff = Math.abs(h.rb - s.rb);
            score += Math.exp(-rbDiff * 0.05);
          }
          totalScore += score;
        });
        return { setting: s.setting, score: totalScore };
      });

      let total = scoreSums.reduce((sum, s) => sum + s.score, 0);
      let finalScores = scoreSums.map(s => {
        return { setting: s.setting, score: ((s.score / total) * 100).toFixed(1) };
      });

      const maxScore = Math.max(...finalScores.map(s => parseFloat(s.score)));

      let html = `<table><tr><th>設定</th><th>可能性（％）</th></tr>`;
      finalScores.forEach(s => {
        const highlightClass = parseFloat(s.score) === maxScore ? 'highlight' : '';
        html += `<tr><td class="${highlightClass}">設定${s.setting}</td><td class="${highlightClass}">${s.score}%</td></tr>`;
      });
      html += `</table><h3>入力履歴</h3><ul>`;
      history.slice().reverse().forEach(h => {
        if (h.at !== null) html += `<li>AT: ${h.at}</li>`;
        else if (h.rb !== null) html += `<li>ボーナス: ${h.rb}</li>`;
      });
      html += `</ul>`;

      document.getElementById("result").innerHTML = html;
    }

    function resetHistory() {
      history = [];
      document.getElementById("result").innerHTML = "<p>履歴をリセットしました。</p>";
    }
  </script>
</body>
</html>